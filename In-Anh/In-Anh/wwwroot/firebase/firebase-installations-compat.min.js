!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("@firebase/app-compat"),require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app-compat","@firebase/app"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).firebase,e.firebase.INTERNAL.modularAPIs)}(this,function(le,ge){"use strict";try{!function(){var r,e=(e=le)&&"object"==typeof e&&"default"in e?e:{default:e};class a extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,a.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,i.prototype.create)}}class i{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){var r,t=t[0]||{},n=this.service+"/"+e,e=(e=this.errors[e])?(r=t,e.replace(M,(e,t)=>{var n=r[t];return null!=n?String(n):`<${t}?>`})):"Error",e=this.serviceName+`: ${e} (${n}).`;return new a(n,e,t)}}const M=/\{\$([^}]+)}/g;class t{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const x=(t,e)=>e.some(e=>t instanceof e);let o,s;const c=new WeakMap,u=new WeakMap,p=new WeakMap,n=new WeakMap,d=new WeakMap;let f={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return u.get(e);if("objectStoreNames"===t)return e.objectStoreNames||p.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return l(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e}};function V(e){return"function"==typeof e?(n=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(s=s||[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey]).includes(n)?function(...e){return n.apply(g(this),e),l(c.get(this))}:function(...e){return l(n.apply(g(this),e))}:function(e,...t){t=n.call(g(this),e,...t);return p.set(t,e.sort?e.sort():[e]),l(t)}:(e instanceof IDBTransaction&&(i=e,u.has(i)||(t=new Promise((e,t)=>{const n=()=>{i.removeEventListener("complete",r),i.removeEventListener("error",a),i.removeEventListener("abort",a)},r=()=>{e(),n()},a=()=>{t(i.error||new DOMException("AbortError","AbortError")),n()};i.addEventListener("complete",r),i.addEventListener("error",a),i.addEventListener("abort",a)}),u.set(i,t))),x(e,o=o||[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])?new Proxy(e,f):e);var n,i,t}function l(e){var i,t;return e instanceof IDBRequest?(i=e,(t=new Promise((e,t)=>{const n=()=>{i.removeEventListener("success",r),i.removeEventListener("error",a)},r=()=>{e(l(i.result)),n()},a=()=>{t(i.error),n()};i.addEventListener("success",r),i.addEventListener("error",a)})).then(e=>{e instanceof IDBCursor&&c.set(e,i)}).catch(()=>{}),d.set(t,i),t):n.has(e)?n.get(e):((t=V(e))!==e&&(n.set(e,t),d.set(t,e)),t)}const g=e=>d.get(e),$=["get","getKey","getAll","getAllKeys","count"],_=["put","add","delete","clear"],h=new Map;function w(e,t){if(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t){if(h.get(t))return h.get(t);const r=t.replace(/FromIndex$/,""),a=t!==r,i=_.includes(r);return r in(a?IDBIndex:IDBObjectStore).prototype&&(i||$.includes(r))?(e=async function(e,...t){e=this.transaction(e,i?"readwrite":"readonly");let n=e.store;return a&&(n=n.index(t.shift())),(await Promise.all([n[r](...t),i&&e.done]))[0]},h.set(t,e),e):void 0}}f={...r=f,get:(e,t,n)=>w(e,t)||r.get(e,t,n),has:(e,t)=>!!w(e,t)||r.has(e,t)};var m="@firebase/installations",v="0.6.4";const y=1e4,F="w:"+v,K="FIS_v2",H="https://firebaseinstallations.googleapis.com/v1",R=36e5,b=new i("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function W(e){return e instanceof a&&e.code.includes("request-failed")}function I({projectId:e}){return H+`/projects/${e}/installations`}function z(e){return{token:e.token,requestStatus:2,expiresIn:(e=e.expiresIn,Number(e.replace("s","000"))),creationTime:Date.now()}}async function S(e,t){t=(await t.json()).error;return b.create("request-failed",{requestName:e,serverCode:t.code,serverMessage:t.message,serverStatus:t.status})}function U({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function J(e,{refreshToken:t}){e=U(e);return e.append("Authorization",K+" "+t),e}async function C(e){var t=await e();return 500<=t.status&&t.status<600?e():t}function G(t){return new Promise(e=>{setTimeout(e,t)})}const Y=/^[cdef][\w-]{21}$/,T="";function k(e){return e.appName+"!"+e.appId}const E=new Map;function Z(e,t){var n,e=k(e);Q(e,t),e=e,t=t,(n=X())&&n.postMessage({key:e,fid:t}),ee()}function Q(e,t){e=E.get(e);if(e)for(const n of e)n(t)}let j=null;function X(){return!j&&"BroadcastChannel"in self&&((j=new BroadcastChannel("[Firebase] FID Change")).onmessage=e=>{Q(e.data.key,e.data.fid)}),j}function ee(){0===E.size&&j&&(j.close(),j=null)}const te="firebase-installations-database",ne=1,D="firebase-installations-store";let re=null;function P(){return re=re||function(e,t,{blocked:n,upgrade:r,blocking:a,terminated:i}){const o=indexedDB.open(e,t),s=l(o);return r&&o.addEventListener("upgradeneeded",e=>{r(l(o.result),e.oldVersion,e.newVersion,l(o.transaction),e)}),n&&o.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),s.then(e=>{i&&e.addEventListener("close",()=>i()),a&&e.addEventListener("versionchange",e=>a(e.oldVersion,e.newVersion,e))}).catch(()=>{}),s}(te,ne,{upgrade:(e,t)=>{0===t&&e.createObjectStore(D)}})}async function B(e,t){var n=k(e),r=(await P()).transaction(D,"readwrite"),a=r.objectStore(D),i=await a.get(n);return await a.put(t,n),await r.done,i&&i.fid===t.fid||Z(e,t.fid),t}async function L(e){var e=k(e),t=(await P()).transaction(D,"readwrite");await t.objectStore(D).delete(e),await t.done}async function q(e,t){var n=k(e),r=(await P()).transaction(D,"readwrite"),a=r.objectStore(D),i=await a.get(n),t=t(i);return void 0===t?await a.delete(n):await a.put(t,n),await r.done,!t||i&&i.fid===t.fid||Z(e,t.fid),t}async function N(a){let i;var e=await q(a.appConfig,e=>{var t,n,r,e=ie(e||{fid:function(){try{var e=new Uint8Array(17),t=((self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16,n=e,btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_").substr(0,22));return Y.test(t)?t:T}catch(t){return T}var n}(),registrationStatus:0}),e=(t=a,0!==(n=e).registrationStatus?1===n.registrationStatus?{installationEntry:n,registrationPromise:async function(e){let t=await ae(e.appConfig);for(;1===t.registrationStatus;)await G(100),t=await ae(e.appConfig);var n,r;return 0!==t.registrationStatus?t:({installationEntry:n,registrationPromise:r}=await N(e),r||n)}(t)}:{installationEntry:n}:navigator.onLine?{installationEntry:r={fid:n.fid,registrationStatus:1,registrationTime:Date.now()},registrationPromise:async function(e,t){try{var n=await async function({appConfig:e,heartbeatServiceProvider:t},{fid:n}){const r=I(e),a=U(e),i=t.getImmediate({optional:!0});i&&(o=await i.getHeartbeatsHeader())&&a.append("x-firebase-client",o);var o={fid:n,authVersion:K,appId:e.appId,sdkVersion:F};const s={method:"POST",headers:a,body:JSON.stringify(o)},c=await C(()=>fetch(r,s));if(c.ok)return{fid:(o=await c.json()).fid||n,registrationStatus:2,refreshToken:o.refreshToken,authToken:z(o.authToken)};throw await S("Create Installation",c)}(e,t);return B(e.appConfig,n)}catch(n){throw W(n)&&409===n.customData.serverCode?await L(e.appConfig):await B(e.appConfig,{fid:t.fid,registrationStatus:0}),n}}(t,r)}:{installationEntry:n,registrationPromise:Promise.reject(b.create("app-offline"))});return i=e.registrationPromise,e.installationEntry});return e.fid===T?{installationEntry:await i}:{installationEntry:e,registrationPromise:i}}function ae(e){return q(e,e=>{if(e)return ie(e);throw b.create("installation-not-found")})}function ie(e){return 1===e.registrationStatus&&e.registrationTime+y<Date.now()?{fid:e.fid,registrationStatus:0}:e}async function O(i,o=!1){let s;var e=await q(i.appConfig,e=>{if(!se(e))throw b.create("not-registered");var t,n,r,a=e.authToken;if(o||2!==(t=a).requestStatus||(n=t,(r=Date.now())<n.creationTime)||n.creationTime+n.expiresIn<r+R){if(1===a.requestStatus)return s=async function(e,t){let n=await oe(e.appConfig);for(;1===n.authToken.requestStatus;)await G(100),n=await oe(e.appConfig);var r=n.authToken;return 0===r.requestStatus?O(e,t):r}(i,o),e;if(navigator.onLine)return t=e,a={requestStatus:1,requestTime:Date.now()},a=Object.assign(Object.assign({},t),{authToken:a}),s=async function(e,t){try{var n=await async function({appConfig:e,heartbeatServiceProvider:t},n){[a,i]=[e,n.fid];const r=I(a)+`/${i}/authTokens:generate`;var a=J(e,n),i=t.getImmediate({optional:!0}),o=(i&&(o=await i.getHeartbeatsHeader())&&a.append("x-firebase-client",o),{installation:{sdkVersion:F,appId:e.appId}});const s={method:"POST",headers:a,body:JSON.stringify(o)},c=await C(()=>fetch(r,s));if(c.ok)return z(await c.json());throw await S("Generate Auth Token",c)}(e,t),r=Object.assign(Object.assign({},t),{authToken:n});return await B(e.appConfig,r),n}catch(r){throw!W(r)||401!==r.customData.serverCode&&404!==r.customData.serverCode?(n=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}}),await B(e.appConfig,n)):await L(e.appConfig),r}}(i,a),a;throw b.create("app-offline")}return e});return s?await s:e.authToken}function oe(e){return q(e,e=>{var t;if(se(e))return 1===(t=e.authToken).requestStatus&&t.requestTime+y<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e;throw b.create("not-registered")})}function se(e){return void 0!==e&&2===e.registrationStatus}async function ce(e){var{installationEntry:t,registrationPromise:n}=await N(e);return(n||O(e)).catch(console.error),t.fid}async function ue(e,t=!1){var n;return await((n=(await N(e)).registrationPromise)&&await n),(await O(e,t)).token}function pe(t,r){const a=t.appConfig;{t=a;var n=r;X(),t=k(t);let e=E.get(t);e||(e=new Set,E.set(t,e)),e.add(n)}return()=>{var e,t,n;e=a,t=r,e=k(e),(n=E.get(e))&&(n.delete(t),0===n.size&&E.delete(e),ee())}}function A(e){return b.create("missing-app-config-values",{valueName:e})}const de="installations";ge._registerComponent(new t(de,e=>{e=e.getProvider("app").getImmediate();return{app:e,appConfig:function(e){if(!e||!e.options)throw A("App Configuration");if(!e.name)throw A("App Name");for(const t of["projectId","apiKey","appId"])if(!e.options[t])throw A(t);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(e),heartbeatServiceProvider:ge._getProvider(e,"heartbeat"),_delete:()=>Promise.resolve()}},"PUBLIC")),ge._registerComponent(new t("installations-internal",e=>{e=e.getProvider("app").getImmediate();const t=ge._getProvider(e,de).getImmediate();return{getId:()=>ce(t),getToken:e=>ue(t,e)}},"PRIVATE")),ge.registerVersion(m,v),ge.registerVersion(m,v,"esm2017");class fe{constructor(e,t){this.app=e,this._delegate=t}getId(){return ce(this._delegate)}getToken(e){return ue(this._delegate,e)}delete(){return async function(e){var t,e=e.appConfig,n=await q(e,e=>{if(!e||0!==e.registrationStatus)return e});if(n){if(1===n.registrationStatus)throw b.create("delete-pending-registration");if(2===n.registrationStatus){if(!navigator.onLine)throw b.create("app-offline");{var r=e;[a,t]=[r,n.fid];const i=I(a)+"/"+t;const o={method:"DELETE",headers:J(r,n)};var a=await C(()=>fetch(i,o));if(!a.ok)throw await S("Delete Installation",a)}await 0,await L(e)}}}(this._delegate)}onIdChange(e){return pe(this._delegate,e)}}(m=e.default).INTERNAL.registerComponent(new t("installations-compat",e=>{var t=e.getProvider("app-compat").getImmediate(),e=e.getProvider("installations").getImmediate();return new fe(t,e)},"PUBLIC")),m.registerVersion("@firebase/installations-compat","0.2.4")}.apply(this,arguments)}catch(e){throw console.error(e),new Error("Cannot instantiate firebase-installations-compat.js - be sure to load firebase-app.js first.")}});